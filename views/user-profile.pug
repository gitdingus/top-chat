extends root 

block scripts 
  script(src='/scripts/friend_request.js' defer)


block content 
  if user && profile 
    h1 Profile for #{profile.username}
    if profile.public
      img(src=profile.image || '/images/account.png')
      p Name: #{profile.firstName || ''} #{profile.lastName || ''}
      p Email: #{profile.email}
      p Birthday: #{profile.birthday || ''}
      p About: #{profile.about}
    p Created: #{profile.created.toLocaleDateString()}
    div(id='friend-status')
      - 
        let friendStatus = 'not found';

        const search = user.friends.find((entry) => {
          if (entry.friend.equals(profile._id)) {
            friendStatus = entry.status;
            return true;
          }
        });

      if friendStatus == 'sent'
        p Friend request sent 
        form(id='friendship-reject')
          input(type='hidden' name='friendId' value=profile._id)
          button(type='submit' name='action' value='reject') Cancel Friend Request
      else if friendStatus == 'recieved'
        form(id='friendship-accept')
          input(type='hidden' name='friendId' value=profile._id)
          button(type='submit') Accept Friend Request 
        form(id='friendship-reject')
          input(type='hidden' name='friendId' value=profile._id)
          button(type='submit' name='action' value='reject') Reject Friend Request
      else if friendStatus == 'friend'
        p You are friends with this user
        form(id='friendship-reject')
          input(type='hidden' name='friendId' value=profile._id)
          button(type='submit' name='action' value='reject') Remove Friend
      else 
        form(id='friend-request')
          input(type='hidden' name='friendId' value=profile._id)
          button(type='submit') Add Friend

  else 
    p Sign up to access this page.